updateInterval = 500;

let demoFlightMeasurements = 150;
let demoFlightLats = [12.0055587535853, 12.0055578649937, 12.0055572693491, 12.0055556322442, 12.0055518990393, 12.0055442885154, 12.0055365751532, 12.0055265959391, 12.005526735909, 12.0055235191942, 12.005518801213, 12.0054785070639, 12.0054442869436, 12.0054451387293, 12.0054473578777, 12.0054485698304, 12.00544881677, 12.0054496164374, 12.0054506190099, 12.0054516344557, 12.0054517881799, 12.0054523683014, 12.0054530909726, 12.0054532487324, 12.005453829799, 12.0054542806783, 12.005454183389, 12.0054543260791, 12.0054551312635, 12.0054554174738, 12.0054558326199, 12.005456336818, 12.0054563794219, 12.0054567702776, 12.0054567463448, 12.0054567608399, 12.0054575640958, 12.005457705279, 12.0054572589845, 12.0054569511529, 12.0054570061064, 12.0054567645945, 12.005455849452, 12.0054556891124, 12.005456191944, 12.0054567429349, 12.0054572933001, 12.0054580377458, 12.0054581733096, 12.0054591650397, 12.0054590815431, 12.0054593553911, 12.0054596302991, 12.0054599799683, 12.0054629343035, 12.0054921615729, 12.0055597032797, 12.0056538827206, 12.0057782925654, 12.0058635476076, 12.0059325815454, 12.0059876577784, 12.0060133404638, 12.0060141721863, 12.0060129111547, 12.0060063523397, 12.0059946987487, 12.0059780089239, 12.0059447989749, 12.0058978952972, 12.0058317731545, 12.0057553808622, 12.0056628419169, 12.0055614569325, 12.0054486515136, 12.0053117272023, 12.0051763455482, 12.0050931131729, 12.0050638317289, 12.0050516208892, 12.0050492375699, 12.0050483483525, 12.0050500071489, 12.0050519928311, 12.0050545467195, 12.0050559550515, 12.0050567212078, 12.0050606281044, 12.0050676111712, 12.0050955229536, 12.0051450068535, 12.0052014821467, 12.0052549691597, 12.0052866335398, 12.005344185273, 12.0053960321096, 12.0054408392019, 12.0054791790982, 12.0055049135955, 12.0055224583349, 12.0055236635701, 12.0055268944862, 12.005522626452, 12.0055214922234, 12.0055248214122, 12.0055266895376, 12.0055266806362, 12.0055257676392, 12.0055260261365, 12.0055263015426, 12.0055275250403, 12.005527845381, 12.0055290202915, 12.0055123987659, 12.0055211937402, 12.0055251685656, 12.0055284480753, 12.0055112233126, 12.0054786883096, 12.0054438427691, 12.0053960398488, 12.0053676714274, 12.0053528598809, 12.0053470719219, 12.0053444451112, 12.0053438580295, 12.0053444405903, 12.0053438974663, 12.0053427340049, 12.0053414293222, 12.0053468811491, 12.0053479417785, 12.0053514878951, 12.0053724174792, 12.0054109987724, 12.005454803522, 12.0054667107573, 12.0054854379102, 12.0055117155187, 12.0055316880013, 12.0055504039987, 12.0055558359796, 12.0055608890392, 12.0055628258852, 12.0055658789463, 12.0055669666502, 12.0055667336438, 12.0055663638985, 12.0055664022881, 12.0055669596964];
let demoFlightLons = [47.8738369894882, 47.8738379112291, 47.8738386933919, 47.8738383042418, 47.8738338862073, 47.8738207212146, 47.8737894784711, 47.8737386786786, 47.8737289207035, 47.8737322647458, 47.8737253012066, 47.8737033167957, 47.8736816773415, 47.873683719775, 47.8736848964105, 47.8736865409435, 47.8736869590107, 47.8736870101829, 47.8736878845791, 47.8736887282955, 47.8736889426769, 47.8736888566169, 47.8736895955527, 47.8736899122525, 47.873689886497, 47.8736891410865, 47.8736892041268, 47.8736890036849, 47.8736890675981, 47.8736890664647, 47.8736892741239, 47.8736901851927, 47.8736908381987, 47.8736917597938, 47.8736924722316, 47.873692787824, 47.8736928206013, 47.8736927824306, 47.8736934049782, 47.8736939160491, 47.8736941863317, 47.8736939688107, 47.8736940185368, 47.8736950907435, 47.8736953411981, 47.8736957503414, 47.8736956349694, 47.8736957653231, 47.873695669766, 47.8736959810985, 47.8736960769422, 47.873696619201, 47.8736969005701, 47.8736974350254, 47.8736972601044, 47.8736778303705, 47.8736476345764, 47.8736059831738, 47.8735772470257, 47.8735836578059, 47.8736057577451, 47.8736398726828, 47.8736626890331, 47.8736673274799, 47.8736682977459, 47.8736579145786, 47.8736432387286, 47.8736259329416, 47.8736041370915, 47.8735898933915, 47.8735873363697, 47.8736010350751, 47.873614957698, 47.8736337643242, 47.8736632669744, 47.8737125082678, 47.8737718100296, 47.8738275858568, 47.8738687407598, 47.8739018506659, 47.8739175917234, 47.8739237050715, 47.8739249892234, 47.8739145084601, 47.873916868108, 47.8739123704369, 47.8739121819152, 47.873899609269, 47.8738780726868, 47.8738589514607, 47.8738420165763, 47.8738375893924, 47.8738373111304, 47.8738328338661, 47.873828053699, 47.8738271090582, 47.8738425600076, 47.8738565822005, 47.8738599996967, 47.873861572132, 47.8738607188916, 47.8738524741389, 47.8738607772396, 47.8738624260636, 47.8738557025639, 47.8738538375205, 47.8738530798238, 47.8738540312259, 47.8738527801923, 47.8738521419343, 47.8738513993276, 47.8738508451334, 47.8738490441122, 47.8738445026749, 47.8738460453724, 47.8738274358527, 47.8738049580819, 47.8737766661147, 47.8737253098438, 47.8736700054496, 47.873595644248, 47.873557644338, 47.8735377037937, 47.8735265994471, 47.8735219686996, 47.8735208310035, 47.8735223038724, 47.8735222771399, 47.8735200855148, 47.8735185475081, 47.8735273056707, 47.8735288954229, 47.8735329874551, 47.8735495394029, 47.873574651286, 47.873605663634, 47.8736182662273, 47.873651795368, 47.8737022320175, 47.873749816252, 47.8737995134902, 47.8738145780562, 47.873828454205, 47.8738535935543, 47.8738591117998, 47.8738579683748, 47.8738580333025, 47.8738583857996, 47.8738583972206, 47.8738583750518];
let demoFlightYaws = [-176.5, -176.5, -176.4, -175.0, -174.9, -174.3, -174.4, -175.4, -174.4, -174.2, -170.4, -165.6, -161.9, -161.7, -161.7, -161.6, -161.6, -161.9, -161.7, -161.6, -161.4, -161.6, -161.7, -161.7, -161.7, -161.7, -161.7, -161.8, -161.6, -161.6, -161.7, -161.7, -161.8, -161.7, -161.7, -161.7, -161.8, -161.7, -161.7, -161.7, -161.7, -161.7, -161.7, -161.7, -161.8, -161.8, -161.8, -161.8, -161.7, -161.7, -161.7, -161.7, -161.7, -161.7, -165.1, 166.7, 135.3, 124.5, 113.1, 109.8, 110.0, 133.6, 142.8, 151.3, -157.5, 157.7, 154.1, 171.9, -135.0, -125.6, -100.7, -83.5, -71.9, -60.6, -51.8, -49.9, -49.4, -49.6, -77.0, -85.0, -85.0, -84.9, -84.8, -84.7, -84.9, -84.8, -99.1, -109.6, -109.5, -71.1, -77.7, -78.7, -83.5, -90.9, -91.1, -95.0, -95.7, -95.5, -95.3, -95.5, -105.1, -104.9, -105.7, -105.2, -171.9, 167.1, 156.0, 74.6, 65.2, -36.4, -105.9, -105.9, -105.8, -105.9, -119.7, -121.7, -146.3, -156.5, -156.5, -156.2, -156.6, -156.4, -156.3, -156.3, -156.3, -156.3, -156.2, -156.3, -156.4, -156.6, -156.2, -156.3, -156.5, -156.7, -156.9, -156.0, -156.0, -156.6, -156.2, -156.6, -156.5, -156.3, -156.6, -156.4, -156.6, -157.0, -157.5, -157.7, -157.7, -157.8]
let demoFlightAlts = [0, 0, 0, 0.100000001490116, 0.5, 2, 4.09999990463257, 4.59999990463257, 4.40000009536743, 4.5, 4.59999990463257, 4.59999990463257, 4.59999990463257, 4.59999990463257, 4.59999990463257, 4.80000019073486, 4.69999980926514, 4.40000009536743, 4.40000009536743, 4.40000009536743, 4.59999990463257, 4.59999990463257, 4.59999990463257, 4.59999990463257, 4.69999980926514, 4.69999980926514, 4.69999980926514, 4.59999990463257, 4.59999990463257, 4.59999990463257, 4.69999980926514, 4.59999990463257, 4.59999990463257, 4.69999980926514, 4.69999980926514, 4.59999990463257, 4.5, 4.5, 4.59999990463257, 4.80000019073486, 4.59999990463257, 4.59999990463257, 4.69999980926514, 4.69999980926514, 4.69999980926514, 4.69999980926514, 4.59999990463257, 4.59999990463257, 4.59999990463257, 4.59999990463257, 4.59999990463257, 4.80000019073486, 4.69999980926514, 4.69999980926514, 4.59999990463257, 4.90000009536743, 4.90000009536743, 4.69999980926514, 4.40000009536743, 4.5, 4.69999980926514, 5, 4.90000009536743, 4.5, 4.59999990463257, 4.59999990463257, 4.5, 4.59999990463257, 4.59999990463257, 4.59999990463257, 4.69999980926514, 4.90000009536743, 5, 4.69999980926514, 4.69999980926514, 4.69999980926514, 4.59999990463257, 4.40000009536743, 5.09999990463257, 5, 4.19999980926514, 3.20000004768372, 2.90000009536743, 2.90000009536743, 2.79999995231628, 2.79999995231628, 2.79999995231628, 2.90000009536743, 3.20000004768372, 3.20000004768372, 3.29999995231628, 3.20000004768372, 3.09999990463257, 3.29999995231628, 3.20000004768372, 2.70000004768372, 2.40000009536743, 2.09999990463257, 1.70000004768372, 1.60000002384186, 1.60000002384186, 1.60000002384186, 1.60000002384186, 1.60000002384186, 1.60000002384186, 1.5, 1.60000002384186, 1.60000002384186, 1.60000002384186, 1.60000002384186, 2.20000004768372, 2.09999990463257, 2.09999990463257, 2.09999990463257, 2.09999990463257, 2.20000004768372, 2.09999990463257, 2.09999990463257, 2.20000004768372, 4.30000019073486, 11.6000003814697, 17.7000007629395, 17.8999996185303, 17.7999992370605, 17.7999992370605, 17.7000007629395, 17.7999992370605, 17.8999996185303, 17.8999996185303, 17.8999996185303, 17.7000007629395, 17.6000003814697, 17.2999992370605, 15.6000003814697, 13.8000001907349, 9.80000019073486, 7.69999980926514, 5.80000019073486, 4.09999990463257, 3, 2.09999990463257, 1.79999995231628, 1.89999997615814, 1.10000002384186, 0.699999988079071, 0.200000002980232, 0, 0, 0, 0]
let demoFlightVelXs = [0.0, 0.0, 0.0, -0.100000001490116, -1.0, -1.79999995231628, -3.0, -3.79999995231628, 0.100000001490116, 0.0, -1.10000002384186, -2.20000004768372, -0.100000001490116, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.200000002980232, -2.0, -2.5, -3.29999995231628, -0.5, 1.29999995231628, 2.20000004768372, 2.09999990463257, 1.39999997615814, 0.100000001490116, -0.200000002980232, -1.10000002384186, -1.29999995231628, -1.5, -1.39999997615814, -0.699999988079071, 0.400000005960464, 1.0, 1.20000004768372, 2.0, 3.0, 4.09999990463257, 4.40000009536743, 4.30000019073486, 3.20000004768372, 1.79999995231628, 1.0, 0.400000005960464, -0.300000011920929, 0.0, -0.200000002980232, 0.0, -0.300000011920929, -1.5, -2.0, -1.70000004768372, -0.600000023841858, -0.300000011920929, 0.200000002980232, -0.5, -0.300000011920929, 0.5, 1.20000004768372, 0.699999988079071, 0.100000001490116, 0.0, 0.0, -0.5, 1.39999997615814, -0.600000023841858, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.300000011920929, -2.20000004768372, -1.20000004768372, -2.79999995231628, -4.19999980926514, -5.09999990463257, -4.59999990463257, -2.5, -1.10000002384186, -0.600000023841858, -0.300000011920929, 0.0, 0.0, -0.100000001490116, -0.200000002980232, 0.100000001490116, 0.200000002980232, 0.0, 0.699999988079071, 1.60000002384186, 2.5, 0.899999976158142, 2.09999990463257, 3.59999990463257, 4.69999980926514, 4.59999990463257, 3.20000004768372, 0.800000011920929, 1.60000002384186, 1.70000004768372, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
let demoFlightVelYs = [0.0, 0.0, 0.0, -0.100000001490116, -0.200000002980232, -0.5, -0.400000005960464, -0.400000005960464, -0.400000005960464, 0.0, -1.20000004768372, -2.59999990463257, -0.100000001490116, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.600000023841858, 2.59999990463257, 4.5, 5.5, 5.40000009536743, 4.5, 3.29999995231628, 1.89999997615814, 0.800000011920929, 0.0, -0.100000001490116, -0.400000005960464, -0.699999988079071, -1.10000002384186, -1.89999997615814, -2.59999990463257, -3.40000009536743, -4.30000019073486, -5.40000009536743, -6.19999980926514, -6.59999990463257, -6.90000009536743, -6.40000009536743, -2.90000009536743, -1.10000002384186, -0.200000002980232, 0.0, 0.0, 0.0, 0.100000001490116, 0.0, 0.0, 0.0, 0.300000011920929, 0.699999988079071, 2.0, 3.29999995231628, 3.29999995231628, 2.09999990463257, 2.90000009536743, 3.59999990463257, 2.79999995231628, 2.40000009536743, 1.0, 1.5, 0.100000001490116, 0.0, 0.0, -0.400000005960464, 0.100000001490116, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.300000011920929, -0.300000011920929, 0.100000001490116, 0.300000011920929, -0.100000001490116, -1.10000002384186, -1.70000004768372, -2.09999990463257, -1.89999997615814, -1.20000004768372, -0.400000005960464, -0.200000002980232, -0.100000001490116, 0.0, 0.0, 0.0, -0.100000001490116, 0.0, 0.100000001490116, 0.0, 0.400000005960464, 1.60000002384186, 2.59999990463257, 0.600000023841858, 1.0, 1.39999997615814, 1.39999997615814, 1.20000004768372, 0.800000011920929, 0.200000002980232, -0.100000001490116, 0.400000005960464, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
let demoFlightVelZs = [0.0, 0.0, 0.0, -0.300000011920929, -0.5, -2.40000009536743, -0.5, -0.200000002980232, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.100000001490116, 0.200000002980232, 0.0, -0.100000001490116, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.100000001490116, 0.100000001490116, 0.0, 0.0, 0.0, -0.100000001490116, 0.0, 0.200000002980232, 1.29999995231628, 0.699999988079071, 0.0, 0.0, 0.0, 0.0, 0.0, -0.100000001490116, -0.300000011920929, 0.0, 0.0, 0.0, 0.0, 0.0, 0.300000011920929, 0.200000002980232, 0.200000002980232, 0.100000001490116, 0.100000001490116, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.300000011920929, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -4.09999990463257, -4.69999980926514, -2.40000009536743, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.300000011920929, 0.0, 0.0, 0.699999988079071, 1.29999995231628, 1.70000004768372, 2.29999995231628, 1.70000004768372, 1.20000004768372, 1.20000004768372, 0.699999988079071, 0.400000005960464, 0.100000001490116, 0.100000001490116, 0.300000011920929, 0.400000005960464, 0.0, 0.0, 0.0, 0.0, 0.0]

document.getElementById('maxSeconds').innerHTML = demoFlightMeasurements;

let demoFlightIndex = 0;
setInterval(() => {
    demoFlightIndex++;
    if (demoFlightIndex >= demoFlightMeasurements) demoFlightIndex = 0

    document.getElementById('secondsPassed').innerHTML = demoFlightIndex + 1;
}, updateInterval);

function back10secs() {
    demoFlightIndex -= 10;
    if (demoFlightIndex < 0) demoFlightIndex = demoFlightMeasurements + demoFlightIndex;

    document.getElementById('secondsPassed').innerHTML = demoFlightIndex + 1;
}

function forward10secs() {
    demoFlightIndex += 10;
    if (demoFlightIndex >= demoFlightMeasurements) demoFlightIndex = demoFlightIndex - demoFlightMeasurements;

    document.getElementById('secondsPassed').innerHTML = demoFlightIndex + 1;
}

function getDemoLat() {
    return demoFlightLats[demoFlightIndex];
}

function getDemoLon() {
    return demoFlightLons[demoFlightIndex];
}

function getDemoYaw() {
    return demoFlightYaws[demoFlightIndex];
}

function getDemoLon() {
    return demoFlightLons[demoFlightIndex];
}

function getDemoAlt() {
    return demoFlightAlts[demoFlightIndex];
}

function getDemoVelX() {
    return demoFlightVelXs[demoFlightIndex];
}

function getDemoVelY() {
    return demoFlightVelYs[demoFlightIndex];
}

function getDemoVelZ() {
    return demoFlightVelZs[demoFlightIndex];
}


class Drone {

    #drone_id;

    #gps_valid;
    #gps_lat;
    #gps_lon;

    #altitude;

    #pitch;
    #yaw;
    #roll;

    #velocityX;
    #velocityY;
    #velocityZ;


    constructor(drone_id) {
        this.#drone_id = drone_id;
        this.setDefaultValues();

        this.#altitude = Math.random() * 10 + 5;
        this.#velocityX = Math.random() * 10 - 5;
        this.#velocityY = Math.random() * 10 - 5;
        this.#velocityZ = Math.random() * 10 - 5;
    }


    setDefaultValues() {
        this.#gps_valid = false;
        this.#gps_lat = 0;
        this.#gps_lon = 0;

        this.#altitude = 0;

        this.#pitch = 0;
        this.#yaw = 0;
        this.#roll = 0;

        this.#velocityX = 0;
        this.#velocityY = 0;
        this.#velocityZ = 0;
    }

    test() {
        this.#velocityX = Math.random() * 10 - 5;
        this.#velocityY = Math.random() * 10 - 5;
        this.#velocityZ = Math.random() * 10 - 5;
    }

    updateValues() {
        // Send request to Traffic Control
    }

    getDroneId() {
        return this.#drone_id;
    }

    getGpsValid() {
        return this.#gps_valid;
    }
    getGpsLat() {
        return this.#gps_lat;
    }
    getGpsLon() {
        return this.#gps_lon;
    }

    getAltitude() {
        return this.#altitude;
    }

    getPitch() {
        return this.#pitch;
    }
    getYaw() {
        return this.#yaw;
    }
    getRoll() {
        return this.#roll;
    }

    getVelocityX() {
        return this.#velocityX;
    }
    getVelocityY() {
        return this.#velocityY;
    }
    getVelocityZ() {
        return this.#velocityZ;
    }

}


// Initialize ALL applets (even though they may not be currently shown)
let droneAltitudeApplet = new DroneAltitudeApplet();
let droneVelocityApplet = new DroneVelocityApplet();

let drones = {
    'demo_drone': new Drone('demo_drone'),
    'demo_drone2': new Drone('demo_drone2')
}

function updateDrones() {
    // Update drone list
    // Add / remove drones
    // Update each drone
}

function updateApplets() {
    droneAltitudeApplet.update(drones);
    droneVelocityApplet.update(drones);
}


window.onload = () => {
    droneAltitudeApplet.init();
    droneVelocityApplet.init();

    setInterval(() => {
        updateDrones();
        updateApplets();
    }, updateInterval);

    setTimeout(() => {
        drones['demo_drone'].test();
    }, 2000);
    setTimeout(() => {
        drones['new_drone'] = new Drone('new_drone');
        drones['demo_drone'].test();
    }, 4000);
    setTimeout(() => {
        drones['demo_drone'].test();
    }, 5000);
}